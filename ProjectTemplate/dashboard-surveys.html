<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cabin&family=Roboto:wght@400;700&display=swap"
          rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <link rel="shortcut icon" type="image/png" href=".\resources\pascal-home.png" />
    <title>Pascal - Surveys</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <script type="text/javascript">
        function SendQuestions(q1, q2, q3, q4, q5) {
            let webMethod = "ProjectServices.asmx/InsertSurvey";
            let parameters = "{\"q1\":\"" + encodeURI(q1) + "\"," + "\"q2\":\"" + encodeURI(q2) + "\"," + "\"q3\":\"" + encodeURI(q3) + "\"," + "\"q4\":\"" + encodeURI(q4) + "\"," + "\"q5\":\"" + encodeURI(q5) + "\" }";

            //jQuery ajax method
            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    // set boolean from web method to a local variable representing the response
                    let responseFromServer = msg.d;
                    alert("Survey has been saved to database.");
                },
                error: function (e) {
                    alert("this code will only execute if javascript is unable to access the webservice");
                }
            });
        }

        //hhinker script for question page code
        let questions = [];

        // counter variable
        let counter = 0;

        const addQuestion = (ev) => {
            ev.preventDefault();  //stops the form submitting
            let question = document.getElementById('questionBox').value
            questions.push(question);
            // to clear the form for the next entries
            document.querySelector('form').reset();

            //this is for display purposes to make sure the text is diplayed as an object
            console.warn('added', { questions });
            let pre = document.querySelector('#msg pre');
            pre.textContent = JSON.stringify(questions);

            // get input from the question box
            var list = question;

            // start a html table
            var table = document.getElementsByTagName('table')[0];

            // add a row to the table
            var newRow = table.insertRow(table.rows.length);

            // add cells to the row
            var cell = newRow.insertCell(0);

            // add text values to the cells
            cell.innerHTML = list;

            // increment counter
            counter++;

            // if user sends 5 questions, disable button so no more can be sent
            if (counter == 5) {
                document.getElementById("btn").disabled = true;
                document.getElementById("msg").innerHTML = "You have entered five questions - your survey has been saved!";
                SendQuestions(questions[0], questions[1], questions[2], questions[3], questions[4]);
            }

        }
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('btn').addEventListener('click', addQuestion);
        });
            //end of hhinker script for question page code

    </script>

</head>
<body>
    <!-- This is the page header. This is universal to all logged-in pages. -->
    <header>
        <div class="row">
            <div class="col-11"><a href="index.html"><img src=".\resources\pascal-home.png" width="30"></a></div>
            <div class="col-01" style="vertical-align: bottom; white-space: nowrap;">
                <a href="logoff.html">Log Out</a>
            </div>
        </div>

        <div class="row">
            <div class="col-12" style="text-align: center; margin: 2em 0 2em 0; padding: 5vh 0;">
                <img src=".\resources\pascal-logo.png" style="width: 30%;">
            </div>
        </div>
    </header>
    <main>
        <div class="row">
            <div class="col-01 filler"></div>
            <a href="dashboard-results.html">
                <div class="col-02 inactivetab">
                    <span>Survey Results</span>
                </div>
            </a>
            <a href="dashboard-surveys.html">
                <div class="col-02 activetab">
                    <span>Manage Surveys</span>
                </div>
            </a>
            <a href="dashboard-rewards.html">
                <div class="col-02 inactivetab">
                    <span>Manage Rewards</span>
                </div>
            </a>
            <a href="dashboard-employees.html">
                <div class="col-02 inactivetab">
                    <span>Manage Employees</span>
                </div>
            </a>
            <a href="dashboard-accountmgr.html">
                <div class="col-02 inactivetab">
                    <span>Manage Account</span>
                </div>
            </a>
            <div class="col-01 filler"></div>
        </div>
        <div class="row">
            <div class="col-01 filler"></div>
            <div class="col-10" style="background-color: #094C8C; height: 1vh;"></div>
            <div class="col-01 filler"></div>
        </div>

        <div class="row">
            <div class="col-01 filler"></div>
            <div class="col-10 box" style="padding: 10px 50px; box-shadow: none; border-radius: 0px 0px 10px 10px;">
                <h1>Pascal Questions</h1>

                <form>
                    <section id="question">
                        <label>Please enter five questions to be asked in your survey:</label><br>
                        <textarea id="questionBox" name="questionBox" placeholder="Enter Question Here"></textarea>
                    </section>

                    <div>
                        <button id="btn">Submit</button>
                        <button type="reset"> Reset</button>
                    </div>
                    <div id="msg">
                        <pre>
                
            </pre>
                    </div>

                </form>

                <table border="1">

                    <tr>
                        <th id="qList">List of Questions</th>

                    </tr>

                </table>
            </div>
        </div>
    </main>

</body>

</html>
